<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Assistir - Meu Streaming</title>
    <style>
        body { background:#0f172a; color:#fff; font-family: sans-serif; margin:0; text-align:center; padding:20px; }
        .container { max-width: 900px; margin: auto; }
        
        /* Player Responsivo */
        .video-wrapper { 
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; 
            border-radius: 12px; background: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .video-wrapper iframe { position: absolute; top:0; left:0; width:100%; height:100%; border:0; }

        .info { text-align: left; margin-top: 20px; background: #1e293b; padding: 25px; border-radius: 12px; }
        h1 { color: #38bdf8; margin-top: 0; }
        p { line-height: 1.6; color: #cbd5e1; }
        
        .botoes { margin-bottom: 20px; display: flex; gap: 10px; justify-content: flex-start; }
        button { 
            padding: 12px 20px; cursor: pointer; border-radius: 8px; border: none; 
            font-weight: bold; transition: 0.3s; background: #334155; color: white;
        }
        button:hover { background: #475569; transform: translateY(-2px); }
        .btn-fav { background: #eab308; color: #000; }
    </style>
</head>
<body>

<div class="container">
    <div id="carregando"><h2>üé¨ Carregando informa√ß√µes...</h2></div>

    <div id="player-area" style="display: none;">
        <div class="botoes">
            <button onclick="location.href='index.htm'">‚¨Ö Voltar</button>
            <button class="btn-fav" onclick="toggleFav()">‚≠ê Favoritar</button>
        </div>

        <div class="video-wrapper">
            <iframe id="player" src="" allowfullscreen></iframe>
        </div>

        <div class="info">
            <h1 id="titulo"></h1>
            <p><strong>Lan√ßamento:</strong> <span id="ano"></span></p>
            <p><strong>G√™neros:</strong> <span id="generos"></span></p>
            <hr style="border: 0; border-top: 1px solid #334155; margin: 20px 0;">
            <p id="sinopse"></p>
        </div>
    </div>
</div>

<script>
let filmeAtual = null;

async function carregar() {
    // 1. Pega o ID da URL
    const idUrl = new URLSearchParams(window.location.search).get("id");

    try {
        // 2. Busca o JSON e aguarda a resposta
        const r = await fetch("catalogo.json");
        const lista = await r.json();

        // 3. Busca o filme comparando como string (mais seguro)
        filmeAtual = lista.find(f => String(f.id) === String(idUrl));

        if (filmeAtual) {
            // 4. Preenche a interface
            document.title = "Assistindo: " + filmeAtual.titulo;
            document.getElementById("titulo").innerText = filmeAtual.titulo;
            document.getElementById("ano").innerText = filmeAtual.ano;
            document.getElementById("sinopse").innerText = filmeAtual.sinopse;
            document.getElementById("generos").innerText = filmeAtual.generos.join(", ");
            document.getElementById("player").src = filmeAtual.link;

            // 5. Mostra o conte√∫do
            document.getElementById("carregando").style.display = "none";
            document.getElementById("player-area").style.display = "block";
        } else {
            document.getElementById("carregando").innerHTML = "<h2>‚ùå Filme n√£o encontrado!</h2><button onclick='location.href=\"index.htm\"'>Voltar ao In√≠cio</button>";
        }
    } catch (erro) {
        console.error(erro);
        document.getElementById("carregando").innerHTML = "<h2>‚ö†Ô∏è Erro ao carregar cat√°logo.</h2>";
    }
}

function toggleFav() {
    if(!filmeAtual) return;
    let favs = JSON.parse(localStorage.getItem("favs") || "[]");
    const id = String(filmeAtual.id);

    if (favs.includes(id)) {
        favs = favs.filter(f => f !== id);
        alert("Removido dos favoritos!");
    } else {
        favs.push(id);
        alert("Adicionado aos favoritos!");
    }
    localStorage.setItem("favs", JSON.stringify(favs));
}

// Inicia o carregamento assim que a p√°gina abre
window.onload = carregar;
</script>

</body>
</html>
