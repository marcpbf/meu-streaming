<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Meus Filmes</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial;
}

/* ===== CABEÃ‡ALHO ===== */
header{
  padding:20px;
}

#busca{
  width:100%;
  padding:12px;
  font-size:18px;
  border-radius:8px;
  border:none;
}

/* ===== BARRA DE GÃŠNEROS ===== */
#generos{
  display:flex;
  gap:12px;
  overflow-x:auto;
  padding:10px 20px;
}

.genero{
  padding:10px 18px;
  background:#222;
  border-radius:20px;
  font-size:16px;
  white-space:nowrap;
}

.genero:focus{
  outline:none;
  background:#22c55e;
  color:#000;
}

/* ===== GRID ===== */
#grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:20px;
  padding:20px;
}

.card{
  transition:transform .15s;
}

.card img{
  width:100%;
  border-radius:12px;
}

.card p{
  text-align:center;
  font-size:14px;
  margin-top:6px;
}

.card:focus{
  outline:none;
  transform:scale(1.15);
  box-shadow:0 0 0 4px #22c55e;
  z-index:10;
}

/* ===== BOTÃƒO MAIS ===== */
#mais{
  display:block;
  margin:30px auto;
  padding:14px 40px;
  font-size:18px;
}
</style>
</head>

<body>

<header>
  <h1>ðŸŽ¬ Meus Filmes</h1>
  <h2>                  ðŸŽ¬ !! CESAR !! ðŸŽ¬ </H2>
  <input id="busca" placeholder="Buscar filme..." tabindex="0">
</header>

<!-- BARRA DE GÃŠNEROS -->
<div id="generos"></div>

<!-- GRID -->
<div id="grid"></div>

<button id="mais" tabindex="0">Carregar mais</button>

<script>
const grid = document.getElementById("grid");
const busca = document.getElementById("busca");
const mais = document.getElementById("mais");
const barraGeneros = document.getElementById("generos");

let filmes = [];
let visiveis = [];
let pagina = 0;
const POR_PAGINA = 30;
let generoAtual = null;

/* ===============================
   CARREGAR CATÃLOGO
================================ */
fetch("catalogo.json")
.then(r=>r.json())
.then(lista=>{
  filmes = lista;
  visiveis = lista;
  pagina = 0;
  grid.innerHTML = "";
  criarBarraGeneros(filmes);
  renderPagina();

  // FOCO INICIAL (OBRIGATÃ“RIO EM TV)
  setTimeout(()=>{
    const primeiroGenero = document.querySelector(".genero");
    if(primeiroGenero) primeiroGenero.focus();
  },300);
});

/* ===============================
   RENDER POR PÃGINA
================================ */
function renderPagina(){
  const inicio = pagina * POR_PAGINA;
  const fim = inicio + POR_PAGINA;
  const parte = visiveis.slice(inicio, fim);

  parte.forEach((f,index)=>{
    const card = document.createElement("div");
    card.className = "card";
    card.tabIndex = 0;
    card.setAttribute("role","button");

    card.innerHTML = `
      <img src="${f.capa}" loading="lazy">
      <p>${f.titulo}</p>
    `;

    card.onclick = ()=>abrirFilme(f.id);
    card.onkeydown = e=>{
      if(e.key==="Enter") abrirFilme(f.id);
    };

    grid.appendChild(card);
  });
}

/* ===============================
   ABRIR FILME
================================ */
function abrirFilme(id){
  location.href = "filme.html?id=" + id;
}

/* ===============================
   CARREGAR MAIS
================================ */
mais.onclick = ()=>{
  pagina++;
  renderPagina();
};

/* ===============================
   BUSCA
================================ */
busca.oninput = aplicarFiltros;

/* ===============================
   CRIAR BARRA DE GÃŠNEROS
================================ */
function criarBarraGeneros(lista){
  const set = new Set();

  lista.forEach(f=>{
    (f.generos||[]).forEach(g=>set.add(g));
  });

  barraGeneros.innerHTML = "";

  criarGenero("Todos", ()=>{
    generoAtual = null;
    aplicarFiltros();
  });

  set.forEach(g=>{
    criarGenero(g, ()=>{
      generoAtual = g;
      aplicarFiltros();
    });
  });
}

/* ===============================
   CRIAR BOTÃƒO DE GÃŠNERO
================================ */
function criarGenero(texto,acao){
  const btn = document.createElement("div");
  btn.className = "genero";
  btn.tabIndex = 0;
  btn.textContent = texto;

  btn.onclick = acao;
  btn.onkeydown = e=>{
    if(e.key==="Enter") acao();
  };

  barraGeneros.appendChild(btn);
}

/* ===============================
   APLICAR FILTROS
================================ */
function aplicarFiltros(){
  let lista = filmes;

  if(generoAtual){
    lista = lista.filter(f=>
      (f.generos||[]).includes(generoAtual)
    );
  }

  const termo = busca.value.toLowerCase();
  if(termo){
    lista = lista.filter(f=>
      f.titulo.toLowerCase().includes(termo)
    );
  }

  visiveis = lista.slice(0,200); // LIMITE PARA TV
  pagina = 0;
  grid.innerHTML = "";
  renderPagina();
}

/* ===============================
   CONTROLE DE SETAS (TV)
================================ */
document.addEventListener("keydown",e=>{
  const foco = document.activeElement;
  if(!foco) return;

  // ENTER
  if(e.key==="Enter"){
    foco.click();
  }

  // â†“ DA BARRA â†’ GRID
  if(e.key==="ArrowDown" && foco.classList.contains("genero")){
    const primeiroCard = document.querySelector(".card");
    if(primeiroCard){
      primeiroCard.focus();
      e.preventDefault();
    }
  }

  // â†‘ DO GRID â†’ BARRA
  if(e.key==="ArrowUp" && foco.classList.contains("card")){
    const primeiroGenero = document.querySelector(".genero");
    if(primeiroGenero){
      primeiroGenero.focus();
      e.preventDefault();
    }
  }
});
</script>

</body>
</html>
