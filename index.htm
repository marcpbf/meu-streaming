<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Meu Streaming - TV Mode</title>
    <style>
        :root { --destaque: #38bdf8; --bg: #070b14; }
        body { background: var(--bg); color: #fff; font-family: Arial, sans-serif; margin: 0; padding: 0; overflow: hidden; }
        
        /* Menu Superior */
        header { padding: 20px 40px; display: flex; gap: 15px; background: rgba(0,0,0,0.5); }
        input, select { padding: 10px; border-radius: 5px; border: none; background: #1e293b; color: #fff; outline: none; }
        input:focus { box-shadow: 0 0 0 3px var(--destaque); }

        /* Estrutura de Fileiras */
        #conteudo { height: calc(100vh - 80px); overflow-y: hidden; padding-top: 20px; }
        .fileira-container { margin-bottom: 30px; transition: transform 0.3s ease; }
        .titulo-gen { margin-left: 50px; font-size: 1.2rem; color: #94a3b8; margin-bottom: 10px; }
        
        .trilho { 
            display: flex; gap: 15px; padding: 10px 50px; 
            overflow-x: hidden; scroll-behavior: smooth; 
        }

        /* Cards */
        .card { 
            flex: 0 0 160px; height: 240px; border-radius: 10px; 
            overflow: hidden; background: #1e293b; outline: none; 
            transition: 0.2s; position: relative;
        }
        .card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .card p { 
            position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8);
            margin: 0; padding: 5px; font-size: 12px; text-align: center;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* Foco do Controle Remoto */
        .card:focus { transform: scale(1.1); z-index: 10; border: 4px solid var(--destaque); }
        .card:focus img { opacity: 1; }
        .card:focus p { background: var(--destaque); color: #000; }
    </style>
</head>
<body>

<header>
    <input type="text" id="busca" placeholder="Buscar título (Controle OK)...">
    <select id="genero-select"><option value="">Todos os Gêneros</option></select>
</header>

<div id="conteudo"></div>

<script>
let filmes = [];
let focoV = 0; // Linha
let focoH = 0; // Coluna

// 1. Carregar o JSON (Funciona offline/GitHub)
fetch("catalogo.json")
    .then(r => r.json())
    .then(dados => {
        filmes = dados;
        popularGeneros();
        montarHome();
    });

function popularGeneros() {
    const gens = [...new Set(filmes.flatMap(f => f.generos))];
    const sel = document.getElementById("genero-select");
    gens.sort().forEach(g => sel.add(new Option(g, g)));
}

function montarHome(lista = filmes) {
    const container = document.getElementById("conteudo");
    container.innerHTML = "";
    
    // Pegar apenas os primeiros 8 gêneros para a Home não travar
    const generos = [...new Set(lista.flatMap(f => f.generos))].slice(0, 8);
    
    // Adiciona "Destaques" (os 15 primeiros do JSON)
    criarFileira("Destaques", lista.slice(0, 15));

    // Adiciona Fileiras por Gênero
    generos.forEach(g => {
        const filmesDoGeral = lista.filter(f => f.generos.includes(g)).slice(0, 15);
        if(filmesDoGeral.length > 0) criarFileira(g, filmesDoGeral);
    });

    setTimeout(atualizarFoco, 300);
}

function criarFileira(titulo, itens) {
    const div = document.createElement("div");
    div.className = "fileira-container";
    div.innerHTML = `
        <div class="titulo-gen">${titulo}</div>
        <div class="trilho">
            ${itens.map(f => `
                <div class="card" tabindex="0" onclick="location.href='filme.html?id=${f.id}'">
                    <img src="${f.capa}" loading="lazy">
                    <p>${f.titulo}</p>
                </div>
            `).join('')}
        </div>
    `;
    document.getElementById("conteudo").appendChild(div);
}

// 2. Lógica do Controle Remoto (Setas e OK)
document.addEventListener("keydown", e => {
    const trilhos = document.querySelectorAll(".trilho");
    if(!trilhos.length) return;

    if (e.key === "ArrowRight") focoH++;
    else if (e.key === "ArrowLeft") focoH = Math.max(0, focoH - 1);
    else if (e.key === "ArrowDown") { focoV++; focoH = 0; }
    else if (e.key === "ArrowUp") { focoV = Math.max(0, focoV - 1); focoH = 0; }
    else if (e.key === "Enter") {
        const atual = trilhos[focoV].querySelectorAll(".card")[focoH];
        if(atual) atual.click();
        return;
    }

    // Limites verticais
    if (focoV >= trilhos.length) focoV = trilhos.length - 1;
    
    // Limites horizontais
    const cardsNaLinha = trilhos[focoV].querySelectorAll(".card");
    if (focoH >= cardsNaLinha.length) focoH = cardsNaLinha.length - 1;

    atualizarFoco();
    e.preventDefault();
});

function atualizarFoco() {
    const fileiras = document.querySelectorAll(".fileira-container");
    const trilhos = document.querySelectorAll(".trilho");
    const card = trilhos[focoV]?.querySelectorAll(".card")[focoH];

    if (card) {
        card.focus();
        // Centraliza o card horizontalmente
        card.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        // Move a fileira inteira para o centro vertical
        fileiras[focoV].scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

// 3. Busca e Filtro (Mantém a TV leve mostrando apenas 20 resultados)
document.getElementById("busca").oninput = (e) => {
    const t = e.target.value.toLowerCase();
    if(t.length > 2) {
        const res = filmes.filter(f => f.titulo.toLowerCase().includes(t)).slice(0, 20);
        document.getElementById("conteudo").innerHTML = "";
        criarFileira("Resultado da Busca", res);
        focoV = 0; focoH = 0;
    } else if (t.length === 0) {
        montarHome();
    }
};
</script>
</body>
</html>
