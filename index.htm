<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Minha TV Box - Streaming</title>
    <style>
        :root { --destaque: #38bdf8; --bg: #070b14; --card-w: 180px; --card-h: 260px; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Roboto, Arial; margin: 0; overflow: hidden; }
        
        /* Cabeçalho Fixo */
        header { padding: 20px 50px; background: linear-gradient(to bottom, rgba(7,11,20,1), transparent); display: flex; gap: 20px; align-items: center; }
        input { background: #1e293b; border: 2px solid transparent; color: #fff; padding: 12px; border-radius: 8px; width: 300px; outline: none; }
        input:focus { border-color: var(--destaque); }

        /* Container de Fileiras */
        #conteudo { height: calc(100vh - 100px); overflow-y: hidden; padding-bottom: 50px; }
        .fileira-container { margin-bottom: 25px; transition: transform 0.3s ease; }
        .fileira-titulo { margin-left: 50px; font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; color: #cbd5e1; }
        
        .trilho { 
            display: flex; 
            gap: 15px; 
            padding: 10px 50px;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Card Otimizado */
        .card { 
            flex: 0 0 var(--card-w); 
            height: var(--card-h);
            position: relative;
            outline: none;
            cursor: pointer;
        }
        .card img { 
            width: 100%; height: 100%; 
            object-fit: cover; 
            border-radius: 8px; 
            background: #1e293b; /* Placeholder enquanto carrega */
            border: 3px solid transparent;
            transition: 0.2s;
        }
        .card p { 
            position: absolute; bottom: 0; width: 100%; 
            background: rgba(0,0,0,0.7); margin: 0; padding: 5px;
            font-size: 11px; text-align: center; border-radius: 0 0 8px 8px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* Efeito de Foco do Controle Remoto */
        .card:focus img { border-color: var(--destaque); transform: scale(1.1); box-shadow: 0 0 20px rgba(56, 189, 248, 0.5); }
        .card:focus p { background: var(--destaque); color: #000; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <input type="text" id="busca" placeholder="Pesquisar títulos...">
    <div id="status">Carregando catálogo...</div>
</header>

<div id="conteudo"></div>

<script>
let catalogo = [];
let focoV = 0; // Índice da fileira
let focoH = 0; // Índice do filme na fileira

async function iniciar() {
    try {
        const resp = await fetch("catalogo.json");
        catalogo = await resp.json();
        document.getElementById("status").innerText = `${catalogo.length} títulos disponíveis`;
        
        montarHome();
    } catch (e) {
        console.error("Erro ao carregar JSON", e);
    }
}

function montarHome() {
    const container = document.getElementById("conteudo");
    container.innerHTML = "";

    // 1. Criar fileira de "Adicionados Recentemente" (primeiros 20)
    criarFileira("Destaques", catalogo.slice(0, 20));

    // 2. Criar fileiras por Gênero (Dinâmico)
    const generosSet = new Set();
    catalogo.forEach(f => f.generos.forEach(g => generosSet.add(g)));
    
    // Pegamos os 10 primeiros gêneros para não pesar a home
    const principaisGeneros = Array.from(generosSet).slice(0, 10);
    
    principaisGeneros.forEach(gen => {
        const filmesGen = catalogo.filter(f => f.generos.includes(gen)).slice(0, 20);
        criarFileira(gen, filmesGen);
    });

    // Focar no primeiro filme após carregar
    setTimeout(() => focarCard(), 500);
}

function criarFileira(titulo, listaFilmes) {
    const section = document.createElement("div");
    section.className = "fileira-container";
    
    section.innerHTML = `
        <div class="fileira-titulo">${titulo}</div>
        <div class="trilho">
            ${listaFilmes.map(f => `
                <div class="card" tabindex="0" onclick="abrirFilme('${f.link}')">
                    <img src="${f.capa}" loading="lazy">
                    <p>${f.titulo}</p>
                </div>
            `).join('')}
        </div>
    `;
    document.getElementById("conteudo").appendChild(section);
}

function abrirFilme(url) {
    // Aqui você pode redirecionar para seu player.html ou abrir direto o link
    window.location.href = "player.html?url=" + encodeURIComponent(url);
}

// NAVEGAÇÃO POR CONTROLE REMOTO
document.addEventListener("keydown", (e) => {
    const fileiras = document.querySelectorAll(".trilho");
    if (!fileiras[focoV]) return;

    const cards = fileiras[focoV].querySelectorAll(".card");

    if (e.key === "ArrowRight") {
        if (focoH < cards.length - 1) focoH++;
    } 
    else if (e.key === "ArrowLeft") {
        if (focoH > 0) focoH--;
    } 
    else if (e.key === "ArrowDown") {
        if (focoV < fileiras.length - 1) {
            focoV++;
            focoH = Math.min(focoH, fileiras[focoV].querySelectorAll(".card").length - 1);
        }
    } 
    else if (e.key === "ArrowUp") {
        if (focoV > 0) {
            focoV--;
            focoH = Math.min(focoH, fileiras[focoV].querySelectorAll(".card").length - 1);
        }
    } 
    else if (e.key === "Enter") {
        cards[focoH].click();
    }

    focarCard();
    e.preventDefault();
});

function focarCard() {
    const fileiras = document.querySelectorAll(".fileira-container");
    const trilhos = document.querySelectorAll(".trilho");
    
    const cardAlvo = trilhos[focoV].querySelectorAll(".card")[focoH];
    
    if (cardAlvo) {
        cardAlvo.focus();
        
        // Scroll horizontal do trilho
        cardAlvo.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        
        // Scroll vertical da página (move a fileira inteira)
        fileiras[focoV].scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

// BUSCA (Filtragem rápida)
document.getElementById("busca").oninput = (e) => {
    const termo = e.target.value.toLowerCase();
    if (termo.length > 2) {
        const resultados = catalogo.filter(f => f.titulo.toLowerCase().includes(termo)).slice(0, 30);
        const container = document.getElementById("conteudo");
        container.innerHTML = "";
        criarFileira("Resultados da Busca", resultados);
        focoV = 0; focoH = 0;
        setTimeout(focarCard, 100);
    } else if (termo.length === 0) {
        montarHome();
    }
};

iniciar();
</script>

</body>
</html>
