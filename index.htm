<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <title>Meu Streaming - In√≠cio</title>
    <style>
        body { background:#0f172a; color:#fff; font-family:Arial, sans-serif; margin:0; padding:20px; overflow-x:hidden; }
        #topbar { display:flex; gap:10px; margin-bottom:20px; flex-wrap: wrap; }
        input, select, button { padding:10px; border-radius:6px; border:none; font-size:14px; background:#1e293b; color:#fff; outline:none; }
        input:focus, select:focus, button:focus { background:#334155; box-shadow:0 0 0 2px #38bdf8; }
        
        .grid { display:grid; grid-template-columns:repeat(auto-fill, 180px); gap:20px; justify-content:center; }
        .card { cursor:pointer; transition:.2s; outline:none; position:relative; }
        .card:hover, .card:focus { transform:scale(1.1); z-index:10; }
        .card img { width:180px; height:260px; object-fit:cover; border-radius:12px; box-shadow:0 10px 20px rgba(0,0,0,0.5); }
        .card:focus img { border: 3px solid #38bdf8; }
        .card p { font-size:13px; margin-top:8px; text-align:center; font-weight:bold; }
    </style>
</head>
<body>

<h2>üé¨ Meu Streaming</h2>

<div id="topbar">
    <input id="busca" placeholder="Buscar filme..." autocomplete="off">
    <select id="genero">
        <option value="">Todos os g√™neros</option>
    </select>
    <button onclick="mostrarFavoritos()">‚≠ê Favoritos</button>
    <button onclick="render(filmes)">üìÇ Todos</button>
</div>

<div id="grid" class="grid">Carregando cat√°logo...</div>

<script>
let filmes = [];
let filmesFiltrados = [];
let pos = 0;

// Carregar Dados
fetch("catalogo.json")
    .then(r => r.json())
    .then(lista => {
        filmes = lista;
        montarGeneros(lista);
        render(lista);
    });

function montarGeneros(lista) {
    const generos = new Set();
    lista.forEach(f => f.generos?.forEach(g => generos.add(g)));
    const select = document.getElementById("genero");
    generos.forEach(g => {
        const op = new Option(g, g);
        select.add(op);
    });
}

function render(lista) {
    filmesFiltrados = lista;
    const grid = document.getElementById("grid");
    grid.innerHTML = lista.length ? "" : "<p>Nenhum filme encontrado.</p>";
    
    lista.forEach((f, i) => {
        const d = document.createElement("div");
        d.className = "card";
        d.tabIndex = 0;
        d.innerHTML = `<img src="${f.capa}"><p>${f.titulo}</p>`;
        d.onclick = () => location.href = "filme.html?id=" + f.id;
        grid.appendChild(d);
    });
    pos = 0; // Reseta posi√ß√£o ao renderizar
}

// Filtros
const filtrar = () => {
    const termo = busca.value.toLowerCase();
    const gen = genero.value;
    const res = filmes.filter(f => 
        f.titulo.toLowerCase().includes(termo) && (gen === "" || f.generos.includes(gen))
    );
    render(res);
};

busca.oninput = filtrar;
genero.onchange = filtrar;

function mostrarFavoritos() {
    const favs = JSON.parse(localStorage.getItem("favs") || "[]");
    render(filmes.filter(f => favs.includes(f.id)));
}

// CONTROLE REMOTO (MODO TV)
document.addEventListener("keydown", e => {
    const cards = document.querySelectorAll(".card");
    if (!cards.length) return;

    // Calcula colunas dinamicamente para o pulo de linha
    const colunas = Math.floor(document.getElementById("grid").offsetWidth / 200);

    if (e.key === "ArrowRight") pos++;
    else if (e.key === "ArrowLeft") pos--;
    else if (e.key === "ArrowDown") pos += colunas;
    else if (e.key === "ArrowUp") pos -= colunas;
    else if (e.key === "Enter") { cards[pos].click(); return; }
    else return;

    pos = Math.max(0, Math.min(pos, cards.length - 1));
    cards[pos].focus();
    cards[pos].scrollIntoView({ behavior: 'smooth', block: 'center' });
    e.preventDefault();
});
</script>
</body>
</html>
